////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////// LAB_N_1 /////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////// PRE-COMPILATION DIRECTIVES  //////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

# include <string.h>
# include <stdio.h>
# include <stdlib.h>

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////// FUNCTIONS DEFINITION  /////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// "functions.h"

void writeOutput (FILE* inputFile, char* outputName);

void writeLexicals (FILE* outputFile, char word[], int lexiconSize);

int main(int argc, char const *argv[]);

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////// PASCAL LANGUAGE LEXICAL COMPONENTS //////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const char* lexicon[] = {
                        "letter", "digit", "..", "<=", ">=", ":=", ".", "E", "+", "-", "NIL", "'", "character", "(", ")", ",", "↑",
                        "PACKED", "ARRAY", "[", "]", "OF", "FILE", "SET", "RECORD", "END", ";", ":", "CASE", "NOT", "*", "/", "DIV",
                        "MOD", "AND", "OR", "=", "<", ">", "#", "IN", "FUNCTION", "VAR", "PROCEDURE", "BEGIN", "IF", "THEN", "ELSE",
                        "WHILE", "DO", "REPEAT", "UNTIL", "FOR", "DOWNTO", "TO", "WITH", "GOTO", "LABEL", "CONST", "TYPE"
                        };

const char* outputLexicon[] = {
                        "LETTER", "DIGIT", "..", "<=", ">=", ":=", ".", "E", "+", "-", "NIL", "'", "CHARACTER", "(", ")", ",", "↑",
                        "PACKED", "ARRAY", "[", "]", "OF", "FILE", "SET", "RECORD", "END", ";", ":", "CASE", "NOT", "*", "/", "DIV",
                        "MOD", "AND", "OR", "=", "<", ">", "#", "IN", "FUNCTION", "VAR", "PROCEDURE", "BEGIN", "IF", "THEN", "ELSE",
                        "WHILE", "DO", "REPEAT", "UNTIL", "FOR", "DOWNTO", "TO", "WITH", "GOTO", "LABEL", "CONST", "TYPE"
                        };

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////// FUNCTIONS IMPLEMENTATION //////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// - INPUTS: - inputFile: Puntero FILE que contiene la lectura del archivo de entrada
//           - outputName: Cadena de caracteres con el nombre de salida ingresado por el usuario
// - OUTPUTS: -
// - DESCRIPTION: Toma un archivo de entrada con un texto, y determina que palabras de este se pueden considerar como parte de los componentes lexicos del lenguaje Pascal


void writeOutput (FILE* inputFile, char outputName[]) {

    FILE* outputFile = fopen(outputName, "w");
    int lexiconSize = sizeof(lexicon)/sizeof(lexicon[0]);
    char word[50];

    while (!feof(inputFile)) {
        fscanf(inputFile, "%s", word);
        writeLexicals(outputFile, word, lexiconSize);
    }
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// - INPUTS: - outputFile: Puntero FILE en el cual se escriben los componentes lexicos reconocidos.
//           - word: Cadena de caracteres que se esta evaluando si es, o contiene algun componente lexico del lenguaje Pascal
//           - lexiconSize: Numero de componentes lexicos del lenguaje Pascal
// - OUTPUTS: -
// - DESCRIPTION: A partir de una cadena de caracteres de entrada recorre cada uno de sus caracteres y a paritr de ese evalua si sus caracteres consecutivos logran corresponder
//                a alguna de las cadenas de caracteres del arreglo "lexicon" que contiene los componentes lexicos reconocidos por el lenguaje Pascal, en caso de encontrar alguna
//                o mas ocurrencias la escribe en Mayuscula en el archivo de salida "outputFile"

void writeLexicals (FILE* outputFile, char word[], int lexiconSize) {

    int wordIndex, wordSize, lexicalIndex;
    wordIndex = 0;
    wordSize = strlen(word);

    while (wordIndex < wordSize) {

        for (lexicalIndex = 0; lexicalIndex < lexiconSize; lexicalIndex++) {
            int lexicalSize = strlen (lexicon[lexicalIndex]);

            if ( (wordIndex + lexicalSize) <= wordSize) {
                
                printf("%s - %s\n", word, lexicon[lexicalIndex]);

                if (strncmp(word, lexicon[lexicalIndex], lexicalSize) == 0) {
                    fprintf(outputFile, "%s\n", outputLexicon[lexicalIndex]);
                    wordIndex += (lexicalSize - 1);
                    word += (lexicalSize - 1);
                    break;
                }
            } 
        }
        wordIndex++;
        word++;
    }
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////// MAIN ////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

int main(int argc, char const *argv[]) {

    FILE* inputFile;
    FILE* outputFile;
    char inputName[20];
    char outputName[20];

    switch (argc) {

        case 1:
            printf("Error: Faltan par%cmetros.\nUso: lexico.exe archivo_entrada archivo_salida\n", 160);
            break;

        case 2:
            printf("Error: Falta par%cmetro.\nUso: lexico.exe archivo_entrada archivo_salida\n", 160);
            break;
        
        case 3:
            strcpy(inputName, argv[1]);
            strcpy(outputName, argv[2]);
            inputFile = fopen(inputName, "r");
            outputFile = fopen(outputName, "r");

            if (inputFile == NULL) 
                printf("Error: El archivo de entrada no existe.\n");

            else if (outputFile != NULL)
                printf("Error: El archivo de salida ya existe.\n");

            else writeOutput (inputFile, outputName);

            break;

        default:
            printf("Error: Demasiados par%cmetros\nUso: lexico.exe archivo_entrada archivo_salida\n", 160);
            break;
    }

    return 0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////